<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <title>Sync Note</title>
    <link rel="icon" href="/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js"></script>

    <script>
        !function () { "use strict"; var a = function (a) { var b, c = {}, d = "text-align:left;"; return c.th = function (a) { if ("" === a.trim()) return ""; var b = a.trim().replace(/ /g, "_").toLowerCase(); return '<th id="' + b + '" style="' + d + '">' + a + "</th>" }, c.td = function (b) { return '<td style="' + d + '">' + a.makeHtml(b) + "</td>" }, c.ths = function () { var a = "", b = 0, d = [].slice.apply(arguments); for (b; b < d.length; b += 1)a += c.th(d[b]) + "\n"; return a }, c.tds = function () { var a = "", b = 0, d = [].slice.apply(arguments); for (b; b < d.length; b += 1)a += c.td(d[b]) + "\n"; return a }, c.thead = function () { var a, b = [].slice.apply(arguments); return a = "<thead>\n", a += "<tr>\n", a += c.ths.apply(this, b), a += "</tr>\n", a += "</thead>\n" }, c.tr = function () { var a, b = [].slice.apply(arguments); return a = "<tr>\n", a += c.tds.apply(this, b), a += "</tr>\n" }, b = function (a) { var b, d, e = 0, f = a.split("\n"), g = []; for (e; e < f.length; e += 1) { if (b = f[e], b.trim().match(/^[|].*[|]$/)) { b = b.trim(); var h = []; if (h.push("<table>"), d = b.substring(1, b.length - 1).split("|"), h.push(c.thead.apply(this, d)), b = f[++e], b.trim().match(/^[|][-=|: ]+[|]$/)) { for (b = f[++e], h.push("<tbody>"); b.trim().match(/^[|].*[|]$/);)b = b.trim(), h.push(c.tr.apply(this, b.substring(1, b.length - 1).split("|"))), b = f[++e]; h.push("</tbody>"), h.push("</table>"), g.push(h.join("\n")); continue } b = f[--e] } g.push(b) } return g.join("\n") }, [{ type: "lang", filter: b }] }; "undefined" != typeof window && window.showdown && window.showdown.extensions && (window.showdown.extensions.table = a), "undefined" != typeof module && (module.exports = a) }();
    </script>
</head>

<body>
    <div id="note-all-id">
        <textarea id="note-md-id" title="Edit" placeholder="edit markdown here"></textarea>
        <div id="note-blank-id"></div>
        <div id="note-html-id"></div>
    </div>

    <script>
        var latest;
        const html = document.getElementById("note-html-id");
        const markdown = document.getElementById("note-md-id");
        const converter = new showdown.Converter({extensions: ['table']});

        window.onload = () => {
            document.cookie = 'sessionId=' + crypto.randomUUID();
            talk();
        };

        markdown.onchange = () => {
            console.log("new content: " + markdown.value);
            html.innerHTML = converter.makeHtml(markdown.value);
            fetch("update", {
                headers: {
                    "Content-Type": "text/plain"
                },
                method: "POST",
                body: markdown.value
            })
        }
        markdown.onkeypress = (event) => {
            if (event.keyCode == 13) {
                console.log("new content: " + markdown.value);
                html.innerHTML = converter.makeHtml(markdown.value);
                fetch("update", {
                    headers: {
                        "Content-Type": "text/plain"
                    },
                    method: "POST",
                    body: markdown.value
                })
            }
        }

        function talk() {
            latest = new WebSocket(`wss://${location.host}/echo`);
            latest.onopen = () => {
                console.log("connect successfully");
            };
            latest.onclose = () => {
                console.log("connect closed");
            };
            latest.onmessage = (response) => {
                console.log("received message: " + response.data);
                markdown.value = response.data;
                html.innerHTML = converter.makeHtml(markdown.value) || '<h1>preview here</h1>';
            };
        }
    </script>
    <style>
        body {
            margin: 0px;
        }

        #note-all-id {
            margin: 0px;
            display: flex;
            height: 100vh;
        }

        #note-md-id {
            resize: none;
            width: 49%;
        }

        /* hide scroll */
        #note-md-id::-webkit-scrollbar {
            width: 0 !important
        }

        /* hide scroll for firefox */
        #note-md-id {
            overflow: -moz-scrollbars-none;
        }

        #note-blank-id {
            width: 2%;
        }

        #note-html-id {
            overflow-y: auto;
            width: 49%;
        }

        /* hide scroll */
        #note-html-id::-webkit-scrollbar {
            width: 0 !important
        }

        /* hide scroll for firefox */
        #note-html-id {
            overflow: -moz-scrollbars-none;
        }
    </style>
</body>

</html>
